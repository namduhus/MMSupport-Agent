# AGENTS.md
이 문서는 한국 거주 외국인을 위한 멀티에이전트 의료 상담 시스템 입니다.
---

## 기술스택
- Python 3.12
- Agent: LangChain V1.0 + LangGraph V1.0
- DataBase: PostgreSQL
- GraphDB: Neo4j
- VectorDB: QdrantDB
- ML: LightGBM / LSTM
- BackEnd: FastAPI
- docker-compose 구조

## 필요사항
- AGENTS.md 확인하기
- 폴더 구조 및 파일 확인하기
- 사용자의 지시가 너가 이해 했는지 다시 확인받기

## 코딩스타일
- 설명형 개발: 코드 작성 시 각 단계의 목적과 이유를 설명
- 강사형 접근: 전문가이지만 옆에서 가르치는 듯한 친근한 톤
- 단계별 진행: 복잡한 작업을 작은 단위로 나누어 설명과 함께 진행
- 이유 중심: "왜 이렇게 하는지"에 대한 설명 포함
- 선택지 제안: 여러 구현 방법이 있을 때 장단점과 함께 제안
- PEP 8: Python 표준 스타일 가이드 준수
- Type Hints: 모든 함수와 변수에 타입 어노테이션 사용
- Docstrings: 함수와 클래스에 명확한 설명 추가
- 변수명: snake_case (함수, 변수), PascalCase (클래스)
- 주석: 한글 주석으로 설명
- 구조화: 각 기능별로 모듈을 분리하여 관리

## 🧠 1. RAGAgent
- **역할**: 사용자가 증상이나 질문에 대해 관련 의료 정보(진료 절차, 질병 정보, 비용 등)를 검색하고, 문화적 맥락을 반영하여 응답을 생성
- **목표**: 사용자가 진료 전 이해할 수 있는 수준의 정보 제공 + 신뢰도 있는 의료 응답 구성
- **입력**:
  - 사용자 자연어 질의 (다국어 지원)
  - 사용자 메타 정보 (국적, 연령, 선호 언어 등)
- **출력**:
  - 유사 질병 정보
  - 추천 진료과
  - 진료 절차 및 비용 정보
- **내부 플로우**:
  1. 다국어 입력 → 한국어 또는 내부 표준 언어로 번역
  2. 입력을 Vector로 변환
  3. Qdrant에서 유사 문서 검색
  4. GraphDB를 통해 cultural context 판단
  5. Qdrant 결과와 GraphDB 조정 결과를 통합
  6. 최종 응답 구성
- **의존 리소스**:
  - Qdrant (VectorDB)
  - GraphDB (문화적 컨텍스트용)
  - LangChain / LangGraph
---

## 🔍 2. DiseasePredictorAgent
- **역할**: 사용자 입력 기반으로 가능성 있는 질병을 예측함
- **입력**:
  - 사용자 증상 (자연어)
  - 기본 프로필 (성별, 연령대 등)
- **출력**:
  - 상위 3개 질병 예측 결과
- **내부 플로우**:
  - 입력 텍스트 전처리 (언어 감지 및 번역, 증상 키워드 추출)
  - 사용자 정보와 결합하여 모델 입력 생성
  - ML 기반 모델 실행 (LightGBM 또는 LSTM 기반)
  - 예측 결과 후처리 (Top-3 필터링, 신뢰도 기준 적용)
  - 다음 단계 Agent에 전달할 구조화된 결과 생성
- **의존 리소스**:
  - 전처리 파이프라인 (언어 감지, 번역기, 증상 키워드 추출기)
  - LightGBM or LSTM 모델 (사전 훈련된 단기 질병 예측 모델)
  - 증상-질병 사전 데이터셋  
---

## 📄 3. MedicalReportAgent
- **역할**: 예측된 질병과 증상 설명을 바탕으로, 병원 제출용 소견서를 자동 생성
- **목표**: 사용자에게 신뢰할 수 있는 문서 형태의 요약을 제공하여 병원 커뮤니케이션을 지원
- **입력**:
  - 증상 설명
  - 예측 질병 리스트
  - 사용자 정보 (국적, 언어)
- **출력**:
  - 다국어 소견서 (요약문 + 예측 + 추천 진료과)
- **내부 플로우**:
  1. 템플릿 기반 프롬프트 생성
  2. LLM 응답 생성
  3. 사용자에게 결과 출력 및 다운로드 제공
- **의존 리소스**:
  - LLM (소견서 생성용)
---

## 🔀 Agent Orchestration (LangGraph 기반 흐름)
- 사용자 입력 →
  - RAGAgent → 질의 정보 안내  
  - DiseasePredictorAgent → 질병 예측  
  - MedicalReportAgent → 소견서 작성  
- 필요 시 GraphDB 기반 의미 조정 수행
- LangGraph가 각 Agent 호출 순서를 결정하고 상태 유지
---

